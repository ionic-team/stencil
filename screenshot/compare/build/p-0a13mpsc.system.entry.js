var __awaiter=this&&this.__awaiter||function(e,t,a,i){function r(e){return e instanceof a?e:new a((function(t){t(e)}))}return new(a||(a=Promise))((function(a,n){function s(e){try{l(i.next(e))}catch(e){n(e)}}function o(e){try{l(i["throw"](e))}catch(e){n(e)}}function l(e){e.done?a(e.value):r(e.value).then(s,o)}l((i=i.apply(e,t||[])).next())}))};var __generator=this&&this.__generator||function(e,t){var a={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},i,r,n,s;return s={next:o(0),throw:o(1),return:o(2)},typeof Symbol==="function"&&(s[Symbol.iterator]=function(){return this}),s;function o(e){return function(t){return l([e,t])}}function l(s){if(i)throw new TypeError("Generator is already executing.");while(a)try{if(i=1,r&&(n=s[0]&2?r["return"]:s[0]?r["throw"]||((n=r["return"])&&n.call(r),0):r.next)&&!(n=n.call(r,s[1])).done)return n;if(r=0,n)s=[s[0]&2,n.value];switch(s[0]){case 0:case 1:n=s;break;case 4:a.label++;return{value:s[1],done:false};case 5:a.label++;r=s[1];s=[0];continue;case 7:s=a.ops.pop();a.trys.pop();continue;default:if(!(n=a.trys,n=n.length>0&&n[n.length-1])&&(s[0]===6||s[0]===2)){a=0;continue}if(s[0]===3&&(!n||s[1]>n[0]&&s[1]<n[3])){a.label=s[1];break}if(s[0]===6&&a.label<n[1]){a.label=n[1];n=s;break}if(n&&a.label<n[2]){a.label=n[2];a.ops.push(s);break}if(n[2])a.ops.pop();a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e];r=0}finally{i=n=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:true}}};System.register(["./p-68613371.system.js","./p-54d9d7c2.system.js"],(function(e){"use strict";var t,a,i,r,n;return{setters:[function(e){t=e.r;a=e.d;i=e.h;r=e.g},function(e){n=e.s}],execute:function(){var s=l;var o={threshold:.1,includeAA:false,alpha:.1,aaColor:[255,255,0],diffColor:[255,0,0]};function l(e,t,a,i,r,n){if(!h(e)||!h(t)||a&&!h(a))throw new Error("Image data: Uint8Array, Uint8ClampedArray or Buffer expected.");if(e.length!==t.length||a&&a.length!==e.length)throw new Error("Image sizes do not match.");if(e.length!==i*r*4)throw new Error("Image data size does not match width/height.");n=Object.assign({},o,n);var s=i*r;var l=new Uint32Array(e.buffer,e.byteOffset,s);var f=new Uint32Array(t.buffer,t.byteOffset,s);var d=true;for(var m=0;m<s;m++){if(l[m]!==f[m]){d=false;break}}if(d){if(a){for(var m=0;m<s;m++)y(e,4*m,n.alpha,a)}return 0}var g=35215*n.threshold*n.threshold;var v=0;var w=n.aaColor,b=w[0],A=w[1],I=w[2];var C=n.diffColor,S=C[0],_=C[1],B=C[2];for(var E=0;E<r;E++){for(var x=0;x<i;x++){var L=(E*i+x)*4;var M=u(e,t,L,L);if(M>g){if(!n.includeAA&&(c(e,x,E,i,r,t)||c(t,x,E,i,r,e))){if(a)p(a,L,b,A,I)}else{if(a)p(a,L,S,_,B);v++}}else if(a){y(e,L,n.alpha,a)}}}return v}function h(e){return ArrayBuffer.isView(e)&&e.constructor.BYTES_PER_ELEMENT===1}function c(e,t,a,i,r,n){var s=Math.max(t-1,0);var o=Math.max(a-1,0);var l=Math.min(t+1,i-1);var h=Math.min(a+1,r-1);var c=(a*i+t)*4;var d=t===s||t===l||a===o||a===h?1:0;var m=0;var g=0;var v,p,y,w;for(var b=s;b<=l;b++){for(var A=o;A<=h;A++){if(b===t&&A===a)continue;var I=u(e,e,c,(A*i+b)*4,true);if(I===0){d++;if(d>2)return false}else if(I<m){m=I;v=b;p=A}else if(I>g){g=I;y=b;w=A}}}if(m===0||g===0)return false;return f(e,v,p,i,r)&&f(n,v,p,i,r)||f(e,y,w,i,r)&&f(n,y,w,i,r)}function f(e,t,a,i,r){var n=Math.max(t-1,0);var s=Math.max(a-1,0);var o=Math.min(t+1,i-1);var l=Math.min(a+1,r-1);var h=(a*i+t)*4;var c=t===n||t===o||a===s||a===l?1:0;for(var f=n;f<=o;f++){for(var u=s;u<=l;u++){if(f===t&&u===a)continue;var d=(u*i+f)*4;if(e[h]===e[d]&&e[h+1]===e[d+1]&&e[h+2]===e[d+2]&&e[h+3]===e[d+3])c++;if(c>2)return true}}return false}function u(e,t,a,i,r){var n=e[a+0];var s=e[a+1];var o=e[a+2];var l=e[a+3];var h=t[i+0];var c=t[i+1];var f=t[i+2];var u=t[i+3];if(l===u&&n===h&&s===c&&o===f)return 0;if(l<255){l/=255;n=v(n,l);s=v(s,l);o=v(o,l)}if(u<255){u/=255;h=v(h,u);c=v(c,u);f=v(f,u)}var p=d(n,s,o)-d(h,c,f);if(r)return p;var y=m(n,s,o)-m(h,c,f);var w=g(n,s,o)-g(h,c,f);return.5053*p*p+.299*y*y+.1957*w*w}function d(e,t,a){return e*.29889531+t*.58662247+a*.11448223}function m(e,t,a){return e*.59597799-t*.2741761-a*.32180189}function g(e,t,a){return e*.21147017-t*.52261711+a*.31114694}function v(e,t){return 255+(e-255)*t}function p(e,t,a,i,r){e[t+0]=a;e[t+1]=i;e[t+2]=r;e[t+3]=255}function y(e,t,a,i){var r=e[t+0];var n=e[t+1];var s=e[t+2];var o=v(d(r,n,s),a*e[t+3]/255);p(i,t,o,o,o)}function w(e,t,a,i,r,n){var o=-1;try{var l=document.createElement("canvas");l.width=i;l.height=r;var h=document.createElement("canvas");h.width=i;h.height=r;var c=l.getContext("2d");c.drawImage(e,0,0);var f=h.getContext("2d");f.drawImage(t,0,0);var u=document.createElement("canvas");var d=u.getContext("2d");d.drawImage(e,0,0);d.getImageData(0,0,i,r);var m=c.getImageData(0,0,i,r).data;var g=f.getImageData(0,0,i,r).data;var v=a.getContext("2d");var p=v.createImageData(i,l.height);o=s(m,g,p.data,i,r,{threshold:n});v.putImageData(p,0,0)}catch(e){console.error(e)}return o}function b(e,t,a){if(I.has(t)){a(I.get(t));return}if(A.has(t)){var i=A.get(t);i.push(a);return}A.set(t,[a]);var r=document.createElement("script");r.src=e+"screenshot_"+t+".js";document.head.appendChild(r)}window.loadScreenshot=function(e,t){var a=A.get(e);if(a){a.forEach((function(e){return e(t)}));A.delete(e)}I.set(e,t)};var A=new Map;var I=new Map;var C=e("compare_row",function(){function e(e){t(this,e);this.imageASrc=null;this.imageBSrc=null;this.imageAClass="is-loading";this.imageBClass="is-loading";this.canvasClass="is-loading";this.imagesLoaded=new Set;this.isImageALoaded=false;this.isImageBLoaded=false;this.isMismatchInitialized=false;this.hasCalculatedMismatch=false;this.compareLoaded=a(this,"compareLoaded",7)}e.prototype.componentWillLoad=function(){this.loadScreenshots()};e.prototype.componentWillUpdate=function(){this.loadScreenshots()};e.prototype.loadScreenshots=function(){var e=this;if(!this.show||!this.diff.hasIntersected){return}if(this.diff.identical){this.imageASrc=this.imagesUrl+this.diff.imageA;this.isImageALoaded=true;this.imageAClass="has-loaded";this.imageBSrc=this.imagesUrl+this.diff.imageB;this.isImageBLoaded=true;this.imageBClass="has-loaded";return}if(this.isMismatchInitialized){return}this.isMismatchInitialized=true;if(this.jsonpUrl!=null){if(this.diff.imageA!=null){b(this.jsonpUrl,this.diff.imageA,(function(t){e.imageASrc=t}))}if(this.diff.imageB!=null){b(this.jsonpUrl,this.diff.imageB,(function(t){e.imageBSrc=t}))}}else{this.imageASrc=this.imagesUrl+this.diff.imageA;this.imageBSrc=this.imagesUrl+this.diff.imageB}};e.prototype.compareImages=function(){return __awaiter(this,void 0,void 0,(function(){var e,t;return __generator(this,(function(a){switch(a.label){case 0:e=this.diff;if(!this.isImageALoaded||!this.isImageBLoaded||this.hasCalculatedMismatch||!e.comparable){return[2]}this.hasCalculatedMismatch=true;t=e;return[4,w(this.imageA,this.imageB,this.canvas,Math.round(e.width*e.deviceScaleFactor),Math.round(e.height*e.deviceScaleFactor),e.threshold)];case 1:t.mismatchedPixels=a.sent();this.canvasClass="has-loaded";n(e.imageA,e.imageB,e.mismatchedPixels,e.threshold);this.compareLoaded.emit(e);return[2]}}))}))};e.prototype.render=function(){var e=this;var t=this.diff;var a={width:t.width+"px",height:t.height+"px"};return[i("compare-cell",null,t.imageA!=null?i("a",{href:this.imagesUrl+t.imageA,target:"_blank"},i("img",{src:this.imageASrc,class:this.imageAClass,style:a,onLoad:this.diff.identical?null:function(){e.isImageALoaded=true;e.imageAClass="has-loaded";e.compareImages()},ref:function(t){return e.imageA=t}})):i("img",{style:a,class:"is-loading"})),i("compare-cell",null,t.imageB!=null?i("a",{href:this.imagesUrl+t.imageB,target:"_blank"},i("img",{src:this.imageBSrc,class:this.imageBClass,style:a,onLoad:this.diff.identical?null:function(){e.isImageBLoaded=true;e.imageBClass="has-loaded";e.compareImages()},ref:function(t){return e.imageB=t}})):i("img",{style:a,class:"is-loading"})),i("compare-cell",null,this.diff.identical?i("img",{style:a,src:this.imageASrc}):i("canvas",{width:Math.round(t.width*t.deviceScaleFactor),height:Math.round(t.height*t.deviceScaleFactor),class:this.canvasClass,style:a,hidden:!t.comparable,ref:function(t){return e.canvas=t}})),i("compare-cell",null,i("compare-analysis",{aId:this.aId,bId:this.bId,mismatchedPixels:this.diff.mismatchedPixels,diff:this.diff}))]};Object.defineProperty(e.prototype,"elm",{get:function(){return r(this)},enumerable:true,configurable:true});Object.defineProperty(e,"style",{get:function(){return"compare-row canvas,compare-row img{display:block;-webkit-box-shadow:var(--screenshot-box-shadow);box-shadow:var(--screenshot-box-shadow);border-radius:var(--screenshot-border-radius)}compare-row a{display:block}.is-loading{visibility:hidden}"},enumerable:true,configurable:true});return e}());var S=e("compare_thead",function(){function e(e){t(this,e)}e.prototype.render=function(){if(!this.a||!this.b||!this.diffs){return}var e=0;this.diffs.forEach((function(t){if(t.width>e){e=t.width}}));e=e-6;var t={width:e+"px"};return[i("th-cell",null,i("div",{style:t},i("a",{href:this.a.url,target:"_blank"},this.a.message))),i("th-cell",null,i("div",{style:t},i("a",{href:this.b.url,target:"_blank"},this.b.message))),i("th-cell",null,i("div",{style:t},i("a",{href:"https://github.com/ionic-team/ionic/compare/"+this.a.id+"..."+this.b.id,target:"_blank"},"Compare: ",this.a.id," - ",this.b.id))),i("th-cell",{class:"analysis"},i("div",null,"Analysis"))]};Object.defineProperty(e,"style",{get:function(){return":host{display:-ms-flexbox;display:flex}th-cell{display:block;-ms-flex:1;flex:1;font-weight:500;font-size:12px}th-cell div{padding-left:12px;padding-right:12px;overflow:hidden;white-space:nowrap;text-overflow:ellipsis}th-cell a{color:var(--font-color);text-decoration:none}th-cell a:hover{color:var(--analysis-data-color);text-decoration:underline}.analysis div{width:262px}"},enumerable:true,configurable:true});return e}())}}}));