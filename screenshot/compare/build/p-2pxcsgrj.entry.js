import{r as t,d as s,h as i,g as e}from"./p-b6e44a24.js";import{s as n}from"./p-113f7459.js";const h={threshold:.1,includeAA:!1,alpha:.1,aaColor:[255,255,0],diffColor:[255,0,0]};function r(t){return ArrayBuffer.isView(t)&&1===t.constructor.BYTES_PER_ELEMENT}function o(t,s,i,e,n,h){const r=Math.max(s-1,0),o=Math.max(i-1,0),c=Math.min(s+1,e-1),u=Math.min(i+1,n-1),d=4*(i*e+s);let f,m,p,g,y=s===r||s===c||i===o||i===u?1:0,w=0,M=0;for(let n=r;n<=c;n++)for(let h=o;h<=u;h++){if(n===s&&h===i)continue;const r=l(t,t,d,4*(h*e+n),!0);if(0===r){if(++y>2)return!1}else r<w?(w=r,f=n,m=h):r>M&&(M=r,p=n,g=h)}return 0!==w&&0!==M&&(a(t,f,m,e,n)&&a(h,f,m,e,n)||a(t,p,g,e,n)&&a(h,p,g,e,n))}function a(t,s,i,e,n){const h=Math.max(s-1,0),r=Math.max(i-1,0),o=Math.min(s+1,e-1),a=Math.min(i+1,n-1),l=4*(i*e+s);let c=s===h||s===o||i===r||i===a?1:0;for(let n=h;n<=o;n++)for(let h=r;h<=a;h++){if(n===s&&h===i)continue;const r=4*(h*e+n);if(t[l]===t[r]&&t[l+1]===t[r+1]&&t[l+2]===t[r+2]&&t[l+3]===t[r+3]&&c++,c>2)return!0}return!1}function l(t,s,i,e,n){let h=t[i+0],r=t[i+1],o=t[i+2],a=t[i+3],l=s[e+0],m=s[e+1],p=s[e+2],g=s[e+3];if(a===g&&h===l&&r===m&&o===p)return 0;a<255&&(h=f(h,a/=255),r=f(r,a),o=f(o,a)),g<255&&(l=f(l,g/=255),m=f(m,g),p=f(p,g));const y=c(h,r,o)-c(l,m,p);if(n)return y;const w=u(h,r,o)-u(l,m,p),M=d(h,r,o)-d(l,m,p);return.5053*y*y+.299*w*w+.1957*M*M}function c(t,s,i){return.29889531*t+.58662247*s+.11448223*i}function u(t,s,i){return.59597799*t-.2741761*s-.32180189*i}function d(t,s,i){return.21147017*t-.52261711*s+.31114694*i}function f(t,s){return 255+(t-255)*s}function m(t,s,i,e,n){t[s+0]=i,t[s+1]=e,t[s+2]=n,t[s+3]=255}function p(t,s,i,e){const n=f(c(t[s+0],t[s+1],t[s+2]),i*t[s+3]/255);m(e,s,n,n,n)}function g(t,s,i){if(w.has(s))return void i(w.get(s));if(y.has(s))return void y.get(s).push(i);y.set(s,[i]);const e=document.createElement("script");e.src=`${t}screenshot_${s}.js`,document.head.appendChild(e)}window.loadScreenshot=(t,s)=>{const i=y.get(t);i&&(i.forEach(t=>t(s)),y.delete(t)),w.set(t,s)};const y=new Map,w=new Map,M=class{constructor(i){t(this,i),this.imageASrc=null,this.imageBSrc=null,this.imageAClass="is-loading",this.imageBClass="is-loading",this.canvasClass="is-loading",this.imagesLoaded=new Set,this.isImageALoaded=!1,this.isImageBLoaded=!1,this.isMismatchInitialized=!1,this.hasCalculatedMismatch=!1,this.compareLoaded=s(this,"compareLoaded",7)}componentWillLoad(){this.loadScreenshots()}componentWillUpdate(){this.loadScreenshots()}loadScreenshots(){if(this.show&&this.diff.hasIntersected)return this.diff.identical?(this.imageASrc=this.imagesUrl+this.diff.imageA,this.isImageALoaded=!0,this.imageAClass="has-loaded",this.imageBSrc=this.imagesUrl+this.diff.imageB,this.isImageBLoaded=!0,void(this.imageBClass="has-loaded")):void(this.isMismatchInitialized||(this.isMismatchInitialized=!0,null!=this.jsonpUrl?(null!=this.diff.imageA&&g(this.jsonpUrl,this.diff.imageA,t=>{this.imageASrc=t}),null!=this.diff.imageB&&g(this.jsonpUrl,this.diff.imageB,t=>{this.imageBSrc=t})):(this.imageASrc=this.imagesUrl+this.diff.imageA,this.imageBSrc=this.imagesUrl+this.diff.imageB)))}async compareImages(){const t=this.diff;this.isImageALoaded&&this.isImageBLoaded&&!this.hasCalculatedMismatch&&t.comparable&&(this.hasCalculatedMismatch=!0,t.mismatchedPixels=await function(t,s,i,e,n,a){let c=-1;try{const u=document.createElement("canvas");u.width=e,u.height=n;const d=document.createElement("canvas");d.width=e,d.height=n;const f=u.getContext("2d");f.drawImage(t,0,0);const g=d.getContext("2d");g.drawImage(s,0,0);const y=document.createElement("canvas").getContext("2d");y.drawImage(t,0,0),y.getImageData(0,0,e,n);const w=f.getImageData(0,0,e,n).data,M=g.getImageData(0,0,e,n).data,v=i.getContext("2d"),_=v.createImageData(e,u.height);c=function(t,s,i,e,n,a){if(!r(t)||!r(s)||i&&!r(i))throw new Error("Image data: Uint8Array, Uint8ClampedArray or Buffer expected.");if(t.length!==s.length||i&&i.length!==t.length)throw new Error("Image sizes do not match.");if(t.length!==e*n*4)throw new Error("Image data size does not match width/height.");a=Object.assign({},h,a);const c=e*n,u=new Uint32Array(t.buffer,t.byteOffset,c),d=new Uint32Array(s.buffer,s.byteOffset,c);let f=!0;for(let t=0;t<c;t++)if(u[t]!==d[t]){f=!1;break}if(f){if(i)for(let s=0;s<c;s++)p(t,4*s,a.alpha,i);return 0}const g=35215*a.threshold*a.threshold;let y=0;const[w,M,v]=a.aaColor,[_,E,b]=a.diffColor;for(let h=0;h<n;h++)for(let r=0;r<e;r++){const c=4*(h*e+r);l(t,s,c,c)>g?a.includeAA||!o(t,r,h,e,n,s)&&!o(s,r,h,e,n,t)?(i&&m(i,c,_,E,b),y++):i&&m(i,c,w,M,v):i&&p(t,c,a.alpha,i)}return y}(w,M,_.data,e,n,{threshold:a}),v.putImageData(_,0,0)}catch(t){console.error(t)}return c}(this.imageA,this.imageB,this.canvas,Math.round(t.width*t.deviceScaleFactor),Math.round(t.height*t.deviceScaleFactor),t.threshold),this.canvasClass="has-loaded",n(t.imageA,t.imageB,t.mismatchedPixels,t.threshold),this.compareLoaded.emit(t))}render(){const t=this.diff,s={width:t.width+"px",height:t.height+"px"};return[i("compare-cell",null,null!=t.imageA?i("a",{href:this.imagesUrl+t.imageA,target:"_blank"},i("img",{src:this.imageASrc,class:this.imageAClass,style:s,onLoad:this.diff.identical?null:()=>{this.isImageALoaded=!0,this.imageAClass="has-loaded",this.compareImages()},ref:t=>this.imageA=t})):i("img",{style:s,class:"is-loading"})),i("compare-cell",null,null!=t.imageB?i("a",{href:this.imagesUrl+t.imageB,target:"_blank"},i("img",{src:this.imageBSrc,class:this.imageBClass,style:s,onLoad:this.diff.identical?null:()=>{this.isImageBLoaded=!0,this.imageBClass="has-loaded",this.compareImages()},ref:t=>this.imageB=t})):i("img",{style:s,class:"is-loading"})),i("compare-cell",null,this.diff.identical?i("img",{style:s,src:this.imageASrc}):i("canvas",{width:Math.round(t.width*t.deviceScaleFactor),height:Math.round(t.height*t.deviceScaleFactor),class:this.canvasClass,style:s,hidden:!t.comparable,ref:t=>this.canvas=t})),i("compare-cell",null,i("compare-analysis",{aId:this.aId,bId:this.bId,mismatchedPixels:this.diff.mismatchedPixels,diff:this.diff}))]}get elm(){return e(this)}static get style(){return"compare-row canvas,compare-row img{display:block;-webkit-box-shadow:var(--screenshot-box-shadow);box-shadow:var(--screenshot-box-shadow);border-radius:var(--screenshot-border-radius)}compare-row a{display:block}.is-loading{visibility:hidden}"}},v=class{constructor(s){t(this,s)}render(){if(!this.a||!this.b||!this.diffs)return;let t=0;this.diffs.forEach(s=>{s.width>t&&(t=s.width)});const s={width:(t-=6)+"px"};return[i("th-cell",null,i("div",{style:s},i("a",{href:this.a.url,target:"_blank"},this.a.message))),i("th-cell",null,i("div",{style:s},i("a",{href:this.b.url,target:"_blank"},this.b.message))),i("th-cell",null,i("div",{style:s},i("a",{href:`https://github.com/ionic-team/ionic/compare/${this.a.id}...${this.b.id}`,target:"_blank"},"Compare: ",this.a.id," - ",this.b.id))),i("th-cell",{class:"analysis"},i("div",null,"Analysis"))]}static get style(){return":host{display:-ms-flexbox;display:flex}th-cell{display:block;-ms-flex:1;flex:1;font-weight:500;font-size:12px}th-cell div{padding-left:12px;padding-right:12px;overflow:hidden;white-space:nowrap;text-overflow:ellipsis}th-cell a{color:var(--font-color);text-decoration:none}th-cell a:hover{color:var(--analysis-data-color);text-decoration:underline}.analysis div{width:262px}"}};export{M as compare_row,v as compare_thead};